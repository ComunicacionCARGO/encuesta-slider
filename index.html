<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>¬øC√≥mo arrancamos la semana?</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: "Montserrat", sans-serif;
      background-color: #F2F2F2;
      color: #0D2334;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    canvas#ballpit {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
    }

    h1 {
      color: #D71F36;
      font-weight: 800;
    }

    h1, p, .slider-container, button, .thanks {
      position: relative;
      z-index: 2;
      text-align: center;
    }

    .slider-container {
      width: 90%; max-width: 600px;
      height: 100px;
      position: relative;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 15px;
      border-radius: 10px;
      background: linear-gradient(to right, #0DB4C3, #3DAA37, #F6D21A, #EF8314, #D71F36);
      outline: none;
      position: absolute;
      top: 50%; transform: translateY(-50%);
      z-index: 1;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 60px; height: 60px;
      background: transparent; border: none;
      cursor: grab;
      pointer-events: auto;
      position: relative;
      z-index: 3;
    }

    .emoji-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%) scale(1);
      font-size: 2rem;
      transition: transform 0.2s ease;
      z-index: 2;
      pointer-events: none;
    }

    .emoji-thumb.hovered {
      transform: translate(-50%, -50%) scale(1.3);
    }

    button {
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #D71F36;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      z-index: 2;
    }

    .thanks {
      display: none;
      font-size: 1.2rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>

  <canvas id="ballpit"></canvas>

  <h1>¬øC√≥mo arrancamos la semana?</h1>
  <p>Del 1 al 10, ¬øqu√© tan motivado est√°s para encarar la semana?</p>

  <div class="slider-container">
    <input type="range" min="0" max="10" value="5" step="0.01" id="moodSlider">
    <div class="emoji-thumb" id="thumbEmoji">üòê</div>
  </div>

  <button id="submitBtn" onclick="enviar()">Enviar</button>
  <div class="thanks" id="thanks">¬°Gracias por sumarte a arrancar con energ√≠a! üöÄ</div>

  <script>
    const slider = document.getElementById("moodSlider");
    const thumbEmoji = document.getElementById("thumbEmoji");
    const caras = ["üò¨", "üôÅ", "üòü", "‚òπÔ∏è", "üòê", "üôÇ", "üòå", "üòä", "üòÑ", "üî•", "üöõ"];

    function updateEmoji() {
      const val = +slider.value;
      const pct = val / 10;
      thumbEmoji.textContent = caras[Math.round(val)];
      thumbEmoji.style.left = `calc(${pct * 100}% + ${8 - pct * 16}px)`;
      thumbEmoji.style.fontSize = `${30 + pct * 40}px`;
    }

    slider.addEventListener("input", updateEmoji);
    slider.addEventListener("mousemove", updateEmoji);
    window.addEventListener("resize", updateEmoji);
    updateEmoji();

    slider.addEventListener("mouseenter", () => {
      thumbEmoji.classList.add("hovered");
    });

    slider.addEventListener("mouseleave", () => {
      thumbEmoji.classList.remove("hovered");
    });

    async function enviar() {
      if (localStorage.getItem("encuesta_enviada")) return;
      localStorage.setItem("encuesta_enviada", "true");

      slider.disabled = true;
      document.getElementById("submitBtn").style.display = "none";
      document.getElementById("thanks").style.display = "block";
      triggerExplosion();

      const mood = Math.round(+slider.value);
      const ip = await fetch("https://api64.ipify.org?format=json")
        .then(res => res.json()).then(data => data.ip);

      fetch("https://script.google.com/macros/s/AKfycbyE_LkFHy13uwdZl4jO3gHaWsqzq8OB7Ho8Spiuv0yW1rK2GWpXO3uSFwp_xAx2-kKW/exec", {
        method: "POST",
        body: JSON.stringify({ mood, ip }),
        headers: { "Content-Type": "application/json" },
      })
      .then(res => res.text())
      .then(data => console.log("Respuesta del servidor:", data))
      .catch(err => console.error("Error al enviar datos:", err));

      setTimeout(() => window.close(), 3000);
    }

    const canvas = document.getElementById("ballpit");
    const ctx = canvas.getContext("2d");
    let w, h;
    const balls = [];
    const emojis = [];
    const mouse = { x: -9999, y: -9999 };

    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    }

    function createBalls(n = 60) {
      for (let i = 0; i < n; i++) {
        balls.push({
          x: Math.random() * w,
          y: Math.random() * h,
          r: 8 + Math.random() * 12,
          vx: (Math.random() - 0.5) * 1.5,
          vy: (Math.random() - 0.5) * 1.5,
          color: ["#D71F36", "#0DB4C3", "#3DAA37", "#F6D21A", "#EF8314"][Math.floor(Math.random() * 5)]
        });
      }
    }

    function triggerExplosion() {
      const val = Math.round(+slider.value);
      const emoji = caras[val];
      for (let i = 0; i < 30; i++) {
        emojis.push({
          x: w / 2,
          y: h / 2,
          vx: (Math.random() - 0.5) * 10,
          vy: (Math.random() - 0.5) * 10,
          life: 100,
          char: emoji
        });
      }
    }

    function animate() {
      ctx.clearRect(0, 0, w, h);

      for (let b of balls) {
        b.vx += (Math.random() - 0.5) * 0.2;
        b.vy += (Math.random() - 0.5) * 0.2;

        const dx = b.x - mouse.x;
        const dy = b.y - mouse.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 200) {
          const f = (200 - dist) / 200;
          b.vx += dx / dist * f * 2.5;
          b.vy += dy / dist * f * 2.5;
        }

        b.x += b.vx;
        b.y += b.vy;

        if (b.x < 0 || b.x > w) b.vx *= -1;
        if (b.y < 0 || b.y > h) b.vy *= -1;

        b.vx *= 0.93;
        b.vy *= 0.93;

        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fillStyle = b.color;
        ctx.fill();
      }

      for (let i = emojis.length - 1; i >= 0; i--) {
        const e = emojis[i];
        ctx.font = "32px sans-serif";
        ctx.globalAlpha = e.life / 100;
        ctx.fillText(e.char, e.x, e.y);
        ctx.globalAlpha = 1;
        e.x += e.vx;
        e.y += e.vy;
        e.life--;
        if (e.life <= 0) emojis.splice(i, 1);
      }

      requestAnimationFrame(animate);
    }

    window.addEventListener("mousemove", e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    window.addEventListener("resize", resize);
    resize();
    createBalls();
    animate();
  </script>

</body>
</html>
